<html>
<head>
<title>WebPresent - Controller Client</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Custom styles for this template -->
<link href="slate.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="js/utils.js"></script>
<script type="text/javascript" src="js/reconnecting-websocket.min.js"></script>
<script type="text/javascript" src="config.js?"></script>


<!--------------------------------------------------------
									Start Presentation
----------------------------------------------------------
Processes the Start Presentation Button. Loads the first
slide as the current slide and buffers the second slide in
the hidden frame.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#startPresentation").click(function() 
	{
		$("#startPresentation").hide();
		$("#previousSlide").show();
		$("#nextSlide").show();
		$("#Swap").show();
	
		var firstSlideFilename = $("#nextSlideHidden").val();

		//Set the Hidden frame to the first slide, then force a swap, making it visable.
		$.ajax({
			type: "POST",
			url: "getNextFile.php",
			data: {currentSlide: firstSlideFilename},
			dataType: 'json',
			cache: false,
			success: function(data)
			{
				$("#currentSlideType").val(data.fileType);
				$("#nextSlideHidden").val(data.filename);
				$("#currentSlideHidden").val(data.filename);
				
				if (data.fileType == "mp4" | data.fileType == "webm")
				{
					$("#currentSlideImage").attr('src', 'media/videoThumbnail.jpg');
					sendVideo();
					sendSwap(0);
				}
				else 
				{
					$("#currentSlideImage").attr('src', 'media/' + data.filename);
					sendImage();
					sendSwap(0);
				}
				
				//Set the Hidden frame to the next slide, but don't swap.
				var secondSlideFilename = $("#nextSlideHidden").val();

				$.ajax({
					type: "POST",
					url: "getNextFile.php",
					data: {currentSlide: secondSlideFilename},
					dataType: 'json',
					cache: false,
					success: function(data)
					{
						$("#nextSlideType").val(data.fileType);
						$("#nextSlideHidden").val(data.filename);
						$("#slidePreviewHidden").val(data.filename);
						
						if (data.fileType == "mp4" | data.fileType == "webm")
						{
							$("#previewSlideImage").attr('src', 'media/videoThumbnail.jpg');
							$("#videoControl").show();
							$("#soundControl").show();
							$("#videoControl").val('Play');
							$("#soundControl").val('Unmute');
							sendVideoControl();
							sendSoundControl();
							sendVideo();
						}
						else 
						{
							$("#previewSlideImage").attr('src', 'media/' + data.filename);
							$("#videoControl").hide();
							$("#soundControl").hide();
							sendImage();
						}
					}
				});
			}
		});	
	});
});
</script>


<!--------------------------------------------------------
										Process Next Slide
----------------------------------------------------------
Processes the Next Button. Swaps the hidden frame to the
current visable frame and then buffers the next slide in
the hidden frame.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#nextSlide").click(function() 
	{
		if ($("#currentSlideType").val() == 'mp4' || $("#currentSlideType").val() == 'webm')
		{
			socketSend( 'VPause');
		}
	
		var currentSlide = $("#nextSlideHidden").val();

		//Swaps the frames, then sets the hidden frame to the next slide
		$.ajax({
				type: "POST",
				url: "getNextFile.php",
				data: {currentSlide: currentSlide},
				dataType: 'json',
				cache: false,
				success: function(data)
				{
					$("#currentSlideType").val($("#nextSlideType").val());
					$("#nextSlideType").val(data.fileType);
					$("#nextSlideHidden").val(data.filename);
					$("#slidePreviewHidden").val(data.filename);
					sendSwap(0);
					
					//If  the next slide is a video
					if (data.fileType == "mp4" | data.fileType == "webm")
					{
						sendVideo();
						$("#previewSlideImage").attr('src', 'media/videoThumbnail.jpg');
						$("#currentSlideHidden").val(currentSlide);
					}
					
					//If the next slide isnt a video
					else 
					{
						sendImage();
						$("#previewSlideImage").attr('src', 'media/' + data.filename);
						$("#currentSlideHidden").val(currentSlide);
					}
					
					//Enable/Disable video controls
					if ($("#currentSlideType").val() == "mp4" || $("#currentSlideType").val() == "webm" )
					{
						$("#currentSlideImage").attr('src', 'media/videoThumbnail.jpg');
						$("#videoControl").show();
						$("#soundControl").show();
						$("#videoControl").val('Play');
						$("#soundControl").val('Unmute');
						sendVideoControl();
						sendSoundControl();
					}
					else 
					{
						$("#currentSlideImage").attr('src', 'media/' + currentSlide);
						$("#videoControl").hide();
						$("#soundControl").hide();
					}
				}
		});	
	});
});
</script>

<!--------------------------------------------------------
									Process Previous Slide
----------------------------------------------------------
Processes the Previous Button. Loads the previous slide 
into the hidden frame then swaps the hidden frame to the
current frame. Doesn't pre-buffer.
It then determines what the next slide will be and buffers
it in the hidden frame.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#previousSlide").click(function() 
	{
		if ($("#currentSlideType").val() == 'mp4' || $("#currentSlideType").val() == 'webm')
		{
			socketSend( 'VPause');
		}
		 
		var currentSlide = $("#nextSlideHidden").val();

		//Sets the hidden frame to the previous slide, then loads previous slide
		$.ajax({
			type: "POST",
			url: "getPreviousFile.php",
			data: {currentSlide: currentSlide, isPreview: 'False'},
			dataType: 'json',
			cache: false,
			success: function(data)
			{			
				$("#nextSlideHidden").val(data.filename);
					
				if (data.fileType == "mp4" | data.fileType == "webm")
				{
					sendVideo();
					sendSwap(0);
				}
				else 
				{
					sendImage();
					sendSwap(0);
				}
				
				//Sets the hidden frame to the next slide
				var currentSlide = $("#nextSlideHidden").val();
				
				$.ajax({
					type: "POST",
					url: "getNextFile.php",
					data: {currentSlide: currentSlide},
					dataType: 'json',
					cache: false,
					success: function(data)
					{
						$("#nextSlideType").val(data.fileType);
					
						if (data.fileType == "mp4" | data.fileType == "webm")
						{
							$("#nextSlideHidden").val(data.filename);
							sendVideo(); //May be redundant, NEEDS CHECKING!!!
							$("#slidePreviewHidden").val(data.filename);
							$("#previewSlideImage").attr('src', 'media/videoThumbnail.jpg');
						}
						else 
						{
							$("#nextSlideHidden").val(data.filename);
							sendImage(); //May be redundant, NEEDS CHECKING!!!
							$("#slidePreviewHidden").val(data.filename);
							$("#previewSlideImage").attr('src', 'media/' + data.filename);
						}
						
						//Set the CurrentSlideHidden text box & change current slide image
						var currentSlide = $("#currentSlideHidden").val();

						$.ajax({
							type: "POST",
							url: "getPreviousFile.php",
							data: {currentSlide: currentSlide, isPreview: 'True'},
							dataType: 'json',
							cache: false,
							success: function(data)
							{			
								$("#currentSlideType").val(data.fileType);
								
								if (data.fileType == "mp4" | data.fileType == "webm")
								{
									$("#currentSlideHidden").val(data.filename);
									$("#currentSlideImage").attr('src', 'media/videoThumbnail.jpg');
									$("#videoControl").show();
									$("#soundControl").show();
									$("#videoControl").val('Play');
									$("#soundControl").val('Unmute');
									sendVideoControl();
									sendSoundControl();

								}
								else 
								{
									$("#currentSlideHidden").val(data.filename);
									$("#currentSlideImage").attr('src', 'media/' + data.filename);
									$("#videoControl").hide();
									$("#soundControl").hide();
								}
							}
						});
					}
				});
			}
		});	
	});
});
</script>

<!--------------------------------------------------------
								Process Preview Next
----------------------------------------------------------
Processes the Preview Next Button. It changes the display
image to the next slide, then tracks what the next slide is.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#nextSlidePreview").click(function() 
	{
		var currentSlide = $("#slidePreviewHidden").val();

		//Swaps the frames, then sets the hidden frame to the next slide
		$.ajax({
				type: "POST",
				url: "getNextFile.php",
				data: {currentSlide: currentSlide},
				success: function(data)
				{
					$("#slidePreviewHidden").val(data);
					$("#previewSlideImage").attr('src', 'media/' + data);
				}
		});	
	});
});
</script>

<!--------------------------------------------------------
								Process Preview Previous
----------------------------------------------------------
Processes the Preview previous Button. It changes the 
display image to the previous slide, then tracks what the 
previous slide is.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#previousSlidePreview").click(function() 
	{
		var currentSlide = $("#slidePreviewHidden").val();

		//Swaps the frames, then sets the hidden frame to the next slide
		$.ajax({
				type: "POST",
				url: "getPreviousFile.php",
				data: {currentSlide: currentSlide, isPreview: 'True'},
				success: function(data)
				{
					$("#slidePreviewHidden").val(data);
					$("#previewSlideImage").attr('src', 'media/' + data);
				}
		});	
	});
});
</script>

<!--------------------------------------------------------
								Process Set Current Slide
----------------------------------------------------------
Sets the current slide in the preview pane to be the current
display slide. It sets the hidden frame to the current preview
slide, then swaps the frams, then sets the hidden frame to 
the next frame to buffer it.
--------------------------------------------------------->
<script>
$(document).ready(function() 
{
	$("#setSlide").click(function() 
	{
		var currentSlide = $("#slidePreviewHidden").val();

		//Set the hidden frame to the current preview slide
		$.ajax({
				type: "POST",
				url: "getNextFile.php",
				data: {currentSlide: currentSlide},
				success: function(data)
				{
					$("#nextSlideHidden").val(currentSlide);
					sendImage();
					sendSwap(0);
					$("#nextSlideHidden").val(data);
					sendImage();
					$("#previewSlideImage").attr('src', 'media/' + data);
					$("#currentSlideImage").attr('src', 'media/' + currentSlide);
					$("#currentSlideHidden").val(currentSlide);
				}
		});	
	});
});
</script>

<script type="text/javascript">
function initialise() 
{
  connectToRelay();

  function handleMesg( data ) {
    //console.log('data:' + data);
    var cmd = data.charAt(0);

    if (data.length > 1) { // command with argument
      var arg = data.substring(1, data.length);
      switch (cmd) {
        case 'Y':
          //console.log('ytTime:' + arg);
          //handleYoutubeTime(arg);
          break;
      }
    }
  }
	
	//Hide specified buttons
	$("#videoControl").hide();
	$("#soundControl").hide();
	$("#previousSlide").hide();
	$("#nextSlide").hide();
	$("#Swap").hide();
	$("#startPresentation").show();
	
	//Set Video/Sound Controls
	$("#videoControl").val('Pause');
	$("#soundControl").val('Mute');
}
</script>

<script type="text/javascript">
function sendURL( url ) 
{
	// add check if URL exists
	socketSend( 'U' + url );
}
</script>

<script type="text/javascript">
function sendHTML( html ) 
{
	// add HTML sanity check?
	socketSend( 'H' + html );
}
</script>

<script type="text/javascript">
function sendImage() 
{
	//setTimeout(function()
	//{
		socketSend( 'I' +  document.getElementById("nextSlideHidden").value);
	//},100);
}
</script>

<script type="text/javascript">
function sendVideo() 
{
	// add check if vidURL exists
	socketSend( 'V' + document.getElementById("nextSlideHidden").value);
}
</script>

<script type="text/javascript">
//Relies upon the button for the paramater to send.
function sendVideoControl() 
{
	var controlOption = $("#videoControl").val();
	
	if (controlOption == 'Play')
	{
		$("#videoControl").val('Pause');
	}
	else
	{
		$("#videoControl").val('Play');
	}
	socketSend( 'V' + controlOption);
}
</script>

<script type="text/javascript">
function sendSoundControl(controlOption) 
{
	var controlOption = $("#soundControl").val();
	
	if (controlOption == 'Mute')
	{
		$("#soundControl").val('Unmute');
	}
	else
	{
		$("#soundControl").val('Mute');
	}
	socketSend( 'V' + controlOption);
}
</script>

<script type="text/javascript">
function sendReload() 
{
  socketSend('R');
}
</script>

<script type="text/javascript">
var delay = 1500;
function sendSwap( delay ) 
{
  if (delay && delay > 0) {
    window.setTimeout(function() { socketSend( "S" );}, delay);
  } else {
    socketSend( "S" );
  }
}
</script>


<style type="text/css">
</style>
</head>
<body onLoad="initialise()">
<br>
<div align=center>
    <h1>WebPresent Controller</h1>
</div>
<div class="container">
  	<div class="row">
    	<div class="col-md-5">
			<h3>Current Slide</h3>
        	<iframe src="media/test1.jpg" id="currentSlideImage" height="160" width="250" allowtransparency="true"></iframe>
        	</br></br>
        	<input type="button" class="btn btn-primary btn-md" id="videoControl" onclick="sendVideoControl();" />
        	<input type="button" class="btn btn-primary btn-md" id="soundControl" onclick="sendSoundControl();" />
        	</br></br>
					<input type="button" class="btn btn-primary btn-md" id="startPresentation" value="Start Presentation" />
        	<input type="button" class="btn btn-primary btn-md" id="previousSlide" value="Previous" />
					<input type="button" class="btn btn-primary btn-md" id="nextSlide" value="Next" />
					<input type="button" class="btn btn-primary btn-md" id="Swap" value="Send Swap (Test)" onclick="sendSwap(0);" />
					<br/><br/>
					<input type="text" id="nextSlideHidden" value="" />
					<input type="text" id="currentSlideHidden" value="" />
					<br />
					<input type="text" id="nextSlideType" value="" />
					<input type="text" id="currentSlideType" value="" />
		</div>
		<div class="col-md-2">
    	</div>
    	<div class="col-md-5">
        	<h3>Next Slide</h3>
        	<iframe src="media/test2.jpg" id="previewSlideImage" height="160" width="250" allowtransparency="true"></iframe>
			</br></br>
			<input type="button" style="color: transparent; background-color: transparent; border-color: transparent; cursor: default;" />
        	<input type="button" style="color: transparent; background-color: transparent; border-color: transparent; cursor: default;" />
			<input type="button" style="color: transparent; background-color: transparent; border-color: transparent; cursor: default;" />
			</br></br>
        	<input type="button" class="btn btn-primary btn-md" value="Preview Previous" id="previousSlidePreview"/>
        	<input type="button" class="btn btn-primary btn-md" value="Preview Next" id="nextSlidePreview" />
					<input type="button" class="btn btn-primary btn-md" value="Set Current Slide" id="setSlide" />
					<br/><br/>
					<input type="text" id="slidePreviewHidden" value="" />
			<br/><br/>
			</br></br>
		</div>
	</div>
</div>
<div align=center>
	<input type='button' value='Relay Not OK' style='background-color:#ff8080' id='RelayStatus' />
</div>
<!-- Config from settings.js
<pre><div id="config"></div></pre> -->
</body>
</html>
